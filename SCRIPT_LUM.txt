--
-- PostgreSQL database dump
--

-- Dumped from database version 16.9
-- Dumped by pg_dump version 16.9

-- Started on 2025-09-08 12:53:33

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- TOC entry 2 (class 3079 OID 18465)
-- Name: pgcrypto; Type: EXTENSION; Schema: -; Owner: -
--

CREATE EXTENSION IF NOT EXISTS pgcrypto WITH SCHEMA public;


--
-- TOC entry 5190 (class 0 OID 0)
-- Dependencies: 2
-- Name: EXTENSION pgcrypto; Type: COMMENT; Schema: -; Owner: 
--

COMMENT ON EXTENSION pgcrypto IS 'cryptographic functions';


--
-- TOC entry 300 (class 1255 OID 18891)
-- Name: set_updated_at(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.set_updated_at() RETURNS trigger
    LANGUAGE plpgsql
    AS $$  
begin  
  new.updated_at = now();  
  return new;  
end;  
$$;


ALTER FUNCTION public.set_updated_at() OWNER TO postgres;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- TOC entry 247 (class 1259 OID 18846)
-- Name: event_store; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.event_store (
    id bigint NOT NULL,
    topic text NOT NULL,
    aggregate_type text,
    aggregate_id uuid,
    payload jsonb NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.event_store OWNER TO postgres;

--
-- TOC entry 246 (class 1259 OID 18845)
-- Name: event_store_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.event_store ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.event_store_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 251 (class 1259 OID 18878)
-- Name: images; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.images (
    id bigint NOT NULL,
    external_id uuid NOT NULL,
    owner_type text NOT NULL,
    owner_id bigint NOT NULL,
    object_key text NOT NULL,
    variant text,
    width integer,
    height integer,
    format text,
    is_primary boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


ALTER TABLE public.images OWNER TO postgres;

--
-- TOC entry 250 (class 1259 OID 18877)
-- Name: images_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.images ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.images_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 237 (class 1259 OID 18724)
-- Name: order_items; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.order_items (
    id bigint NOT NULL,
    sub_order_id bigint NOT NULL,
    product_id bigint NOT NULL,
    product_variant_id bigint,
    title text NOT NULL,
    unit_price_cop bigint NOT NULL,
    quantity bigint NOT NULL,
    total_price_cop bigint NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    CONSTRAINT chk_item_totals CHECK (((total_price_cop = (unit_price_cop * quantity)) AND (unit_price_cop >= 0) AND (quantity > 0)))
);


ALTER TABLE public.order_items OWNER TO postgres;

--
-- TOC entry 236 (class 1259 OID 18723)
-- Name: order_items_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.order_items ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.order_items_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 245 (class 1259 OID 18818)
-- Name: order_messages; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.order_messages (
    id bigint NOT NULL,
    order_id bigint NOT NULL,
    from_user_id bigint,
    to_user_id bigint,
    body text NOT NULL,
    attachments jsonb,
    is_read boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.order_messages OWNER TO postgres;

--
-- TOC entry 244 (class 1259 OID 18817)
-- Name: order_messages_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.order_messages ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.order_messages_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 233 (class 1259 OID 18676)
-- Name: orders; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.orders (
    id bigint NOT NULL,
    external_id uuid NOT NULL,
    user_id bigint NOT NULL,
    total_amount_cop bigint NOT NULL,
    currency text DEFAULT 'COP'::text,
    status text DEFAULT 'pending'::text NOT NULL,
    shipping_address jsonb,
    billing_address jsonb,
    metadata jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.orders OWNER TO postgres;

--
-- TOC entry 232 (class 1259 OID 18675)
-- Name: orders_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.orders ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.orders_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 239 (class 1259 OID 18751)
-- Name: payment_intents; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.payment_intents (
    id bigint NOT NULL,
    external_id uuid NOT NULL,
    provider text NOT NULL,
    provider_payment_id text,
    provider_payload jsonb,
    amount_cop bigint NOT NULL,
    currency text DEFAULT 'COP'::text,
    status text DEFAULT 'created'::text NOT NULL,
    order_id bigint,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.payment_intents OWNER TO postgres;

--
-- TOC entry 238 (class 1259 OID 18750)
-- Name: payment_intents_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.payment_intents ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.payment_intents_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 241 (class 1259 OID 18773)
-- Name: payouts; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.payouts (
    id bigint NOT NULL,
    external_id uuid NOT NULL,
    sub_order_id bigint,
    provider text,
    provider_payout_id text,
    amount_cop bigint NOT NULL,
    fee_cop bigint DEFAULT 0,
    status text DEFAULT 'pending'::text NOT NULL,
    attempted_at timestamp with time zone,
    processed_at timestamp with time zone,
    provider_payload jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.payouts OWNER TO postgres;

--
-- TOC entry 240 (class 1259 OID 18772)
-- Name: payouts_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.payouts ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.payouts_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 223 (class 1259 OID 18570)
-- Name: plans; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.plans (
    id bigint NOT NULL,
    plan_key text NOT NULL,
    display_name text NOT NULL,
    monthly_price_cop bigint DEFAULT 0 NOT NULL,
    annual_price_cop bigint,
    commission_rate numeric(5,3) NOT NULL,
    product_limit bigint,
    subuser_limit bigint,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.plans OWNER TO postgres;

--
-- TOC entry 222 (class 1259 OID 18569)
-- Name: plans_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.plans ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.plans_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 229 (class 1259 OID 18630)
-- Name: product_variants; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.product_variants (
    id bigint NOT NULL,
    external_id uuid NOT NULL,
    product_id bigint NOT NULL,
    sku text,
    title text,
    attributes jsonb,
    price_cop bigint,
    quantity bigint DEFAULT 0,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


ALTER TABLE public.product_variants OWNER TO postgres;

--
-- TOC entry 228 (class 1259 OID 18629)
-- Name: product_variants_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.product_variants ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.product_variants_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 249 (class 1259 OID 18857)
-- Name: product_versions; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.product_versions (
    id bigint NOT NULL,
    product_id bigint NOT NULL,
    snapshot jsonb NOT NULL,
    changed_by_user_id bigint,
    change_type text,
    created_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.product_versions OWNER TO postgres;

--
-- TOC entry 248 (class 1259 OID 18856)
-- Name: product_versions_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.product_versions ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.product_versions_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 227 (class 1259 OID 18606)
-- Name: products; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.products (
    id bigint NOT NULL,
    external_id uuid NOT NULL,
    store_id bigint NOT NULL,
    sku text,
    title text NOT NULL,
    description text,
    condition text DEFAULT 'new'::text,
    price_cop bigint NOT NULL,
    currency text DEFAULT 'COP'::text,
    is_published boolean DEFAULT false,
    is_visible boolean DEFAULT true,
    attributes jsonb,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


ALTER TABLE public.products OWNER TO postgres;

--
-- TOC entry 226 (class 1259 OID 18605)
-- Name: products_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.products ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.products_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 243 (class 1259 OID 18793)
-- Name: refunds; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.refunds (
    id bigint NOT NULL,
    external_id uuid NOT NULL,
    payment_intent_id bigint,
    order_id bigint,
    amount_cop bigint NOT NULL,
    reason text,
    fee_cop bigint DEFAULT 0,
    status text DEFAULT 'requested'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    processed_at timestamp with time zone
);


ALTER TABLE public.refunds OWNER TO postgres;

--
-- TOC entry 242 (class 1259 OID 18792)
-- Name: refunds_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.refunds ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.refunds_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 231 (class 1259 OID 18649)
-- Name: reservations; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.reservations (
    id bigint NOT NULL,
    product_variant_id bigint,
    product_id bigint,
    user_id bigint,
    quantity bigint DEFAULT 1 NOT NULL,
    expires_at timestamp with time zone NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    fulfilled boolean DEFAULT false
);


ALTER TABLE public.reservations OWNER TO postgres;

--
-- TOC entry 230 (class 1259 OID 18648)
-- Name: reservations_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.reservations ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.reservations_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 219 (class 1259 OID 18521)
-- Name: stores; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.stores (
    id bigint NOT NULL,
    external_id uuid NOT NULL,
    owner_user_id bigint NOT NULL,
    name text NOT NULL,
    slug text NOT NULL,
    description text,
    logo_key text,
    banner_key text,
    country text DEFAULT 'CO'::text,
    city text,
    is_active boolean DEFAULT true,
    plan text DEFAULT 'free'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


ALTER TABLE public.stores OWNER TO postgres;

--
-- TOC entry 225 (class 1259 OID 18582)
-- Name: subscriptions; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.subscriptions (
    id bigint NOT NULL,
    store_id bigint NOT NULL,
    plan_id bigint NOT NULL,
    starts_at timestamp with time zone DEFAULT now() NOT NULL,
    ends_at timestamp with time zone,
    status text DEFAULT 'active'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.subscriptions OWNER TO postgres;

--
-- TOC entry 252 (class 1259 OID 18899)
-- Name: store_current_subscription; Type: VIEW; Schema: public; Owner: postgres
--

CREATE VIEW public.store_current_subscription AS
 SELECT s.id AS store_id,
    sub.id AS subscription_id,
    sub.plan_id,
    sub.starts_at,
    sub.ends_at,
    sub.status AS subscription_status,
    sub.created_at AS subscription_created_at,
    sub.updated_at AS subscription_updated_at
   FROM (public.stores s
     LEFT JOIN LATERAL ( SELECT ss.id,
            ss.plan_id,
            ss.starts_at,
            ss.ends_at,
            ss.status,
            ss.created_at,
            ss.updated_at
           FROM public.subscriptions ss
          WHERE (ss.store_id = s.id)
          ORDER BY ss.starts_at DESC
         LIMIT 1) sub ON (true));


ALTER VIEW public.store_current_subscription OWNER TO postgres;

--
-- TOC entry 221 (class 1259 OID 18543)
-- Name: store_users; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.store_users (
    id bigint NOT NULL,
    store_id bigint NOT NULL,
    user_id bigint NOT NULL,
    role text NOT NULL,
    can_admin_products boolean DEFAULT false,
    can_view_reports boolean DEFAULT false,
    can_manage_inventory boolean DEFAULT false,
    can_handle_messages boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone,
    CONSTRAINT store_users_role_check CHECK ((role = ANY (ARRAY['administrator'::text, 'seller'::text, 'operations_manager'::text])))
);


ALTER TABLE public.store_users OWNER TO postgres;

--
-- TOC entry 220 (class 1259 OID 18542)
-- Name: store_users_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.store_users ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.store_users_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 218 (class 1259 OID 18520)
-- Name: stores_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.stores ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.stores_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 235 (class 1259 OID 18697)
-- Name: sub_orders; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.sub_orders (
    id bigint NOT NULL,
    external_id uuid NOT NULL,
    order_id bigint NOT NULL,
    store_id bigint NOT NULL,
    subtotal_cop bigint NOT NULL,
    shipping_cop bigint DEFAULT 0,
    marketplace_fee_cop bigint DEFAULT 0,
    seller_net_cop bigint NOT NULL,
    status text DEFAULT 'pending'::text NOT NULL,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL
);


ALTER TABLE public.sub_orders OWNER TO postgres;

--
-- TOC entry 234 (class 1259 OID 18696)
-- Name: sub_orders_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.sub_orders ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.sub_orders_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 224 (class 1259 OID 18581)
-- Name: subscriptions_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.subscriptions ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.subscriptions_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 217 (class 1259 OID 18503)
-- Name: users; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public.users (
    id bigint NOT NULL,
    external_id uuid NOT NULL,
    email text NOT NULL,
    password_hash text,
    full_name text,
    phone text,
    is_verified boolean DEFAULT false,
    can_sell boolean DEFAULT false,
    created_at timestamp with time zone DEFAULT now() NOT NULL,
    updated_at timestamp with time zone DEFAULT now() NOT NULL,
    deleted_at timestamp with time zone
);


ALTER TABLE public.users OWNER TO postgres;

--
-- TOC entry 216 (class 1259 OID 18502)
-- Name: users_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public.users ALTER COLUMN id ADD GENERATED ALWAYS AS IDENTITY (
    SEQUENCE NAME public.users_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- TOC entry 5180 (class 0 OID 18846)
-- Dependencies: 247
-- Data for Name: event_store; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.event_store (id, topic, aggregate_type, aggregate_id, payload, created_at) FROM stdin;
\.


--
-- TOC entry 5184 (class 0 OID 18878)
-- Dependencies: 251
-- Data for Name: images; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.images (id, external_id, owner_type, owner_id, object_key, variant, width, height, format, is_primary, created_at, deleted_at) FROM stdin;
\.


--
-- TOC entry 5170 (class 0 OID 18724)
-- Dependencies: 237
-- Data for Name: order_items; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.order_items (id, sub_order_id, product_id, product_variant_id, title, unit_price_cop, quantity, total_price_cop, created_at) FROM stdin;
\.


--
-- TOC entry 5178 (class 0 OID 18818)
-- Dependencies: 245
-- Data for Name: order_messages; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.order_messages (id, order_id, from_user_id, to_user_id, body, attachments, is_read, created_at) FROM stdin;
\.


--
-- TOC entry 5166 (class 0 OID 18676)
-- Dependencies: 233
-- Data for Name: orders; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.orders (id, external_id, user_id, total_amount_cop, currency, status, shipping_address, billing_address, metadata, created_at, updated_at) FROM stdin;
\.


--
-- TOC entry 5172 (class 0 OID 18751)
-- Dependencies: 239
-- Data for Name: payment_intents; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.payment_intents (id, external_id, provider, provider_payment_id, provider_payload, amount_cop, currency, status, order_id, created_at, updated_at) FROM stdin;
\.


--
-- TOC entry 5174 (class 0 OID 18773)
-- Dependencies: 241
-- Data for Name: payouts; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.payouts (id, external_id, sub_order_id, provider, provider_payout_id, amount_cop, fee_cop, status, attempted_at, processed_at, provider_payload, created_at) FROM stdin;
\.


--
-- TOC entry 5156 (class 0 OID 18570)
-- Dependencies: 223
-- Data for Name: plans; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.plans (id, plan_key, display_name, monthly_price_cop, annual_price_cop, commission_rate, product_limit, subuser_limit, created_at) FROM stdin;
1	free	Free	0	\N	0.090	500	1	2025-09-05 16:08:59.422288-05
2	pro	Pro	100000	800000	0.060	500	5	2025-09-05 16:08:59.422288-05
3	business	Business	300000	3000000	0.050	\N	\N	2025-09-05 16:08:59.422288-05
\.


--
-- TOC entry 5162 (class 0 OID 18630)
-- Dependencies: 229
-- Data for Name: product_variants; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.product_variants (id, external_id, product_id, sku, title, attributes, price_cop, quantity, created_at, updated_at, deleted_at) FROM stdin;
\.


--
-- TOC entry 5182 (class 0 OID 18857)
-- Dependencies: 249
-- Data for Name: product_versions; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.product_versions (id, product_id, snapshot, changed_by_user_id, change_type, created_at) FROM stdin;
\.


--
-- TOC entry 5160 (class 0 OID 18606)
-- Dependencies: 227
-- Data for Name: products; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.products (id, external_id, store_id, sku, title, description, condition, price_cop, currency, is_published, is_visible, attributes, created_at, updated_at, deleted_at) FROM stdin;
\.


--
-- TOC entry 5176 (class 0 OID 18793)
-- Dependencies: 243
-- Data for Name: refunds; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.refunds (id, external_id, payment_intent_id, order_id, amount_cop, reason, fee_cop, status, created_at, processed_at) FROM stdin;
\.


--
-- TOC entry 5164 (class 0 OID 18649)
-- Dependencies: 231
-- Data for Name: reservations; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.reservations (id, product_variant_id, product_id, user_id, quantity, expires_at, created_at, fulfilled) FROM stdin;
\.


--
-- TOC entry 5154 (class 0 OID 18543)
-- Dependencies: 221
-- Data for Name: store_users; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.store_users (id, store_id, user_id, role, can_admin_products, can_view_reports, can_manage_inventory, can_handle_messages, created_at, updated_at, deleted_at) FROM stdin;
\.


--
-- TOC entry 5152 (class 0 OID 18521)
-- Dependencies: 219
-- Data for Name: stores; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.stores (id, external_id, owner_user_id, name, slug, description, logo_key, banner_key, country, city, is_active, plan, created_at, updated_at, deleted_at) FROM stdin;
\.


--
-- TOC entry 5168 (class 0 OID 18697)
-- Dependencies: 235
-- Data for Name: sub_orders; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.sub_orders (id, external_id, order_id, store_id, subtotal_cop, shipping_cop, marketplace_fee_cop, seller_net_cop, status, created_at, updated_at) FROM stdin;
\.


--
-- TOC entry 5158 (class 0 OID 18582)
-- Dependencies: 225
-- Data for Name: subscriptions; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.subscriptions (id, store_id, plan_id, starts_at, ends_at, status, created_at, updated_at) FROM stdin;
\.


--
-- TOC entry 5150 (class 0 OID 18503)
-- Dependencies: 217
-- Data for Name: users; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public.users (id, external_id, email, password_hash, full_name, phone, is_verified, can_sell, created_at, updated_at, deleted_at) FROM stdin;
\.


--
-- TOC entry 5191 (class 0 OID 0)
-- Dependencies: 246
-- Name: event_store_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.event_store_id_seq', 1, false);


--
-- TOC entry 5192 (class 0 OID 0)
-- Dependencies: 250
-- Name: images_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.images_id_seq', 1, false);


--
-- TOC entry 5193 (class 0 OID 0)
-- Dependencies: 236
-- Name: order_items_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.order_items_id_seq', 1, false);


--
-- TOC entry 5194 (class 0 OID 0)
-- Dependencies: 244
-- Name: order_messages_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.order_messages_id_seq', 1, false);


--
-- TOC entry 5195 (class 0 OID 0)
-- Dependencies: 232
-- Name: orders_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.orders_id_seq', 1, false);


--
-- TOC entry 5196 (class 0 OID 0)
-- Dependencies: 238
-- Name: payment_intents_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.payment_intents_id_seq', 1, false);


--
-- TOC entry 5197 (class 0 OID 0)
-- Dependencies: 240
-- Name: payouts_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.payouts_id_seq', 1, false);


--
-- TOC entry 5198 (class 0 OID 0)
-- Dependencies: 222
-- Name: plans_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.plans_id_seq', 3, true);


--
-- TOC entry 5199 (class 0 OID 0)
-- Dependencies: 228
-- Name: product_variants_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.product_variants_id_seq', 1, false);


--
-- TOC entry 5200 (class 0 OID 0)
-- Dependencies: 248
-- Name: product_versions_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.product_versions_id_seq', 1, false);


--
-- TOC entry 5201 (class 0 OID 0)
-- Dependencies: 226
-- Name: products_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.products_id_seq', 1, false);


--
-- TOC entry 5202 (class 0 OID 0)
-- Dependencies: 242
-- Name: refunds_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.refunds_id_seq', 1, false);


--
-- TOC entry 5203 (class 0 OID 0)
-- Dependencies: 230
-- Name: reservations_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.reservations_id_seq', 1, false);


--
-- TOC entry 5204 (class 0 OID 0)
-- Dependencies: 220
-- Name: store_users_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.store_users_id_seq', 1, false);


--
-- TOC entry 5205 (class 0 OID 0)
-- Dependencies: 218
-- Name: stores_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.stores_id_seq', 1, false);


--
-- TOC entry 5206 (class 0 OID 0)
-- Dependencies: 234
-- Name: sub_orders_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.sub_orders_id_seq', 1, false);


--
-- TOC entry 5207 (class 0 OID 0)
-- Dependencies: 224
-- Name: subscriptions_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.subscriptions_id_seq', 1, false);


--
-- TOC entry 5208 (class 0 OID 0)
-- Dependencies: 216
-- Name: users_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.users_id_seq', 1, false);


--
-- TOC entry 4961 (class 2606 OID 18853)
-- Name: event_store event_store_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.event_store
    ADD CONSTRAINT event_store_pkey PRIMARY KEY (id);


--
-- TOC entry 4968 (class 2606 OID 18888)
-- Name: images images_external_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.images
    ADD CONSTRAINT images_external_id_key UNIQUE (external_id);


--
-- TOC entry 4972 (class 2606 OID 18886)
-- Name: images images_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.images
    ADD CONSTRAINT images_pkey PRIMARY KEY (id);


--
-- TOC entry 4932 (class 2606 OID 18731)
-- Name: order_items order_items_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.order_items
    ADD CONSTRAINT order_items_pkey PRIMARY KEY (id);


--
-- TOC entry 4957 (class 2606 OID 18826)
-- Name: order_messages order_messages_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.order_messages
    ADD CONSTRAINT order_messages_pkey PRIMARY KEY (id);


--
-- TOC entry 4921 (class 2606 OID 18688)
-- Name: orders orders_external_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.orders
    ADD CONSTRAINT orders_external_id_key UNIQUE (external_id);


--
-- TOC entry 4923 (class 2606 OID 18686)
-- Name: orders orders_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.orders
    ADD CONSTRAINT orders_pkey PRIMARY KEY (id);


--
-- TOC entry 4936 (class 2606 OID 18763)
-- Name: payment_intents payment_intents_external_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.payment_intents
    ADD CONSTRAINT payment_intents_external_id_key UNIQUE (external_id);


--
-- TOC entry 4939 (class 2606 OID 18761)
-- Name: payment_intents payment_intents_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.payment_intents
    ADD CONSTRAINT payment_intents_pkey PRIMARY KEY (id);


--
-- TOC entry 4943 (class 2606 OID 18784)
-- Name: payouts payouts_external_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.payouts
    ADD CONSTRAINT payouts_external_id_key UNIQUE (external_id);


--
-- TOC entry 4945 (class 2606 OID 18782)
-- Name: payouts payouts_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.payouts
    ADD CONSTRAINT payouts_pkey PRIMARY KEY (id);


--
-- TOC entry 4895 (class 2606 OID 18578)
-- Name: plans plans_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.plans
    ADD CONSTRAINT plans_pkey PRIMARY KEY (id);


--
-- TOC entry 4897 (class 2606 OID 18580)
-- Name: plans plans_plan_key_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.plans
    ADD CONSTRAINT plans_plan_key_key UNIQUE (plan_key);


--
-- TOC entry 4910 (class 2606 OID 18641)
-- Name: product_variants product_variants_external_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.product_variants
    ADD CONSTRAINT product_variants_external_id_key UNIQUE (external_id);


--
-- TOC entry 4912 (class 2606 OID 18639)
-- Name: product_variants product_variants_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.product_variants
    ADD CONSTRAINT product_variants_pkey PRIMARY KEY (id);


--
-- TOC entry 4965 (class 2606 OID 18864)
-- Name: product_versions product_versions_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.product_versions
    ADD CONSTRAINT product_versions_pkey PRIMARY KEY (id);


--
-- TOC entry 4903 (class 2606 OID 18620)
-- Name: products products_external_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.products
    ADD CONSTRAINT products_external_id_key UNIQUE (external_id);


--
-- TOC entry 4905 (class 2606 OID 18618)
-- Name: products products_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.products
    ADD CONSTRAINT products_pkey PRIMARY KEY (id);


--
-- TOC entry 4949 (class 2606 OID 18804)
-- Name: refunds refunds_external_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.refunds
    ADD CONSTRAINT refunds_external_id_key UNIQUE (external_id);


--
-- TOC entry 4953 (class 2606 OID 18802)
-- Name: refunds refunds_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.refunds
    ADD CONSTRAINT refunds_pkey PRIMARY KEY (id);


--
-- TOC entry 4916 (class 2606 OID 18656)
-- Name: reservations reservations_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.reservations
    ADD CONSTRAINT reservations_pkey PRIMARY KEY (id);


--
-- TOC entry 4891 (class 2606 OID 18556)
-- Name: store_users store_users_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.store_users
    ADD CONSTRAINT store_users_pkey PRIMARY KEY (id);


--
-- TOC entry 4885 (class 2606 OID 18534)
-- Name: stores stores_external_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.stores
    ADD CONSTRAINT stores_external_id_key UNIQUE (external_id);


--
-- TOC entry 4888 (class 2606 OID 18532)
-- Name: stores stores_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.stores
    ADD CONSTRAINT stores_pkey PRIMARY KEY (id);


--
-- TOC entry 4926 (class 2606 OID 18710)
-- Name: sub_orders sub_orders_external_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.sub_orders
    ADD CONSTRAINT sub_orders_external_id_key UNIQUE (external_id);


--
-- TOC entry 4929 (class 2606 OID 18708)
-- Name: sub_orders sub_orders_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.sub_orders
    ADD CONSTRAINT sub_orders_pkey PRIMARY KEY (id);


--
-- TOC entry 4899 (class 2606 OID 18592)
-- Name: subscriptions subscriptions_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.subscriptions
    ADD CONSTRAINT subscriptions_pkey PRIMARY KEY (id);


--
-- TOC entry 4879 (class 2606 OID 18517)
-- Name: users users_email_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_email_key UNIQUE (email);


--
-- TOC entry 4881 (class 2606 OID 18515)
-- Name: users users_external_id_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_external_id_key UNIQUE (external_id);


--
-- TOC entry 4883 (class 2606 OID 18513)
-- Name: users users_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT users_pkey PRIMARY KEY (id);


--
-- TOC entry 4959 (class 1259 OID 18855)
-- Name: event_store_aggregate_type_aggregate_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX event_store_aggregate_type_aggregate_id_idx ON public.event_store USING btree (aggregate_type, aggregate_id);


--
-- TOC entry 4962 (class 1259 OID 18854)
-- Name: event_store_topic_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX event_store_topic_idx ON public.event_store USING btree (topic);


--
-- TOC entry 4969 (class 1259 OID 18890)
-- Name: images_object_key_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX images_object_key_idx ON public.images USING btree (object_key);


--
-- TOC entry 4970 (class 1259 OID 18889)
-- Name: images_owner_type_owner_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX images_owner_type_owner_id_idx ON public.images USING btree (owner_type, owner_id);


--
-- TOC entry 4933 (class 1259 OID 18748)
-- Name: order_items_product_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX order_items_product_id_idx ON public.order_items USING btree (product_id);


--
-- TOC entry 4934 (class 1259 OID 18747)
-- Name: order_items_sub_order_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX order_items_sub_order_id_idx ON public.order_items USING btree (sub_order_id);


--
-- TOC entry 4954 (class 1259 OID 18843)
-- Name: order_messages_from_user_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX order_messages_from_user_id_idx ON public.order_messages USING btree (from_user_id);


--
-- TOC entry 4955 (class 1259 OID 18842)
-- Name: order_messages_order_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX order_messages_order_id_idx ON public.order_messages USING btree (order_id);


--
-- TOC entry 4958 (class 1259 OID 18844)
-- Name: order_messages_to_user_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX order_messages_to_user_id_idx ON public.order_messages USING btree (to_user_id);


--
-- TOC entry 4919 (class 1259 OID 18695)
-- Name: orders_created_at_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX orders_created_at_idx ON public.orders USING btree (created_at);


--
-- TOC entry 4924 (class 1259 OID 18694)
-- Name: orders_user_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX orders_user_id_idx ON public.orders USING btree (user_id);


--
-- TOC entry 4937 (class 1259 OID 18770)
-- Name: payment_intents_order_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX payment_intents_order_id_idx ON public.payment_intents USING btree (order_id);


--
-- TOC entry 4940 (class 1259 OID 18769)
-- Name: payment_intents_provider_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX payment_intents_provider_idx ON public.payment_intents USING btree (provider);


--
-- TOC entry 4941 (class 1259 OID 18771)
-- Name: payment_intents_status_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX payment_intents_status_idx ON public.payment_intents USING btree (status);


--
-- TOC entry 4946 (class 1259 OID 18791)
-- Name: payouts_status_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX payouts_status_idx ON public.payouts USING btree (status);


--
-- TOC entry 4947 (class 1259 OID 18790)
-- Name: payouts_sub_order_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX payouts_sub_order_id_idx ON public.payouts USING btree (sub_order_id);


--
-- TOC entry 4913 (class 1259 OID 18647)
-- Name: product_variants_product_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX product_variants_product_id_idx ON public.product_variants USING btree (product_id);


--
-- TOC entry 4963 (class 1259 OID 18876)
-- Name: product_versions_created_at_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX product_versions_created_at_idx ON public.product_versions USING btree (created_at);


--
-- TOC entry 4966 (class 1259 OID 18875)
-- Name: product_versions_product_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX product_versions_product_id_idx ON public.product_versions USING btree (product_id);


--
-- TOC entry 4906 (class 1259 OID 18626)
-- Name: products_store_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX products_store_id_idx ON public.products USING btree (store_id);


--
-- TOC entry 4907 (class 1259 OID 18628)
-- Name: products_store_sku_unique; Type: INDEX; Schema: public; Owner: postgres
--

CREATE UNIQUE INDEX products_store_sku_unique ON public.products USING btree (store_id, sku) WHERE ((sku IS NOT NULL) AND (deleted_at IS NULL));


--
-- TOC entry 4908 (class 1259 OID 18627)
-- Name: products_to_tsvector_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX products_to_tsvector_idx ON public.products USING gin (to_tsvector('spanish'::regconfig, ((COALESCE(title, ''::text) || ' '::text) || COALESCE(description, ''::text))));


--
-- TOC entry 4950 (class 1259 OID 18816)
-- Name: refunds_order_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX refunds_order_id_idx ON public.refunds USING btree (order_id);


--
-- TOC entry 4951 (class 1259 OID 18815)
-- Name: refunds_payment_intent_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX refunds_payment_intent_id_idx ON public.refunds USING btree (payment_intent_id);


--
-- TOC entry 4914 (class 1259 OID 18672)
-- Name: reservations_expires_at_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX reservations_expires_at_idx ON public.reservations USING btree (expires_at);


--
-- TOC entry 4917 (class 1259 OID 18674)
-- Name: reservations_product_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX reservations_product_id_idx ON public.reservations USING btree (product_id);


--
-- TOC entry 4918 (class 1259 OID 18673)
-- Name: reservations_product_variant_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX reservations_product_variant_id_idx ON public.reservations USING btree (product_variant_id);


--
-- TOC entry 4892 (class 1259 OID 18568)
-- Name: store_users_role_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX store_users_role_idx ON public.store_users USING btree (role);


--
-- TOC entry 4893 (class 1259 OID 18567)
-- Name: store_users_store_id_user_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE UNIQUE INDEX store_users_store_id_user_id_idx ON public.store_users USING btree (store_id, user_id) WHERE (deleted_at IS NULL);


--
-- TOC entry 4886 (class 1259 OID 18540)
-- Name: stores_owner_user_id_slug_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE UNIQUE INDEX stores_owner_user_id_slug_idx ON public.stores USING btree (owner_user_id, slug) WHERE (deleted_at IS NULL);


--
-- TOC entry 4889 (class 1259 OID 18541)
-- Name: stores_plan_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX stores_plan_idx ON public.stores USING btree (plan);


--
-- TOC entry 4927 (class 1259 OID 18721)
-- Name: sub_orders_order_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX sub_orders_order_id_idx ON public.sub_orders USING btree (order_id);


--
-- TOC entry 4930 (class 1259 OID 18722)
-- Name: sub_orders_store_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX sub_orders_store_id_idx ON public.sub_orders USING btree (store_id);


--
-- TOC entry 4900 (class 1259 OID 18604)
-- Name: subscriptions_status_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX subscriptions_status_idx ON public.subscriptions USING btree (status);


--
-- TOC entry 4901 (class 1259 OID 18603)
-- Name: subscriptions_store_id_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX subscriptions_store_id_idx ON public.subscriptions USING btree (store_id);


--
-- TOC entry 4876 (class 1259 OID 18518)
-- Name: users_created_at_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX users_created_at_idx ON public.users USING btree (created_at);


--
-- TOC entry 4877 (class 1259 OID 18519)
-- Name: users_email_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE INDEX users_email_idx ON public.users USING btree (email);


--
-- TOC entry 5003 (class 2620 OID 18897)
-- Name: orders orders_set_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER orders_set_updated_at BEFORE UPDATE ON public.orders FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- TOC entry 5004 (class 2620 OID 18898)
-- Name: payment_intents payment_intents_set_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER payment_intents_set_updated_at BEFORE UPDATE ON public.payment_intents FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- TOC entry 5002 (class 2620 OID 18896)
-- Name: product_variants product_variants_set_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER product_variants_set_updated_at BEFORE UPDATE ON public.product_variants FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- TOC entry 5001 (class 2620 OID 18895)
-- Name: products products_set_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER products_set_updated_at BEFORE UPDATE ON public.products FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- TOC entry 4999 (class 2620 OID 18893)
-- Name: stores stores_set_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER stores_set_updated_at BEFORE UPDATE ON public.stores FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- TOC entry 5000 (class 2620 OID 18894)
-- Name: subscriptions subscriptions_set_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER subscriptions_set_updated_at BEFORE UPDATE ON public.subscriptions FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- TOC entry 4998 (class 2620 OID 18892)
-- Name: users users_set_updated_at; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER users_set_updated_at BEFORE UPDATE ON public.users FOR EACH ROW EXECUTE FUNCTION public.set_updated_at();


--
-- TOC entry 4986 (class 2606 OID 18737)
-- Name: order_items order_items_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.order_items
    ADD CONSTRAINT order_items_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id);


--
-- TOC entry 4987 (class 2606 OID 18742)
-- Name: order_items order_items_product_variant_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.order_items
    ADD CONSTRAINT order_items_product_variant_id_fkey FOREIGN KEY (product_variant_id) REFERENCES public.product_variants(id);


--
-- TOC entry 4988 (class 2606 OID 18732)
-- Name: order_items order_items_sub_order_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.order_items
    ADD CONSTRAINT order_items_sub_order_id_fkey FOREIGN KEY (sub_order_id) REFERENCES public.sub_orders(id) ON DELETE CASCADE;


--
-- TOC entry 4993 (class 2606 OID 18832)
-- Name: order_messages order_messages_from_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.order_messages
    ADD CONSTRAINT order_messages_from_user_id_fkey FOREIGN KEY (from_user_id) REFERENCES public.users(id);


--
-- TOC entry 4994 (class 2606 OID 18827)
-- Name: order_messages order_messages_order_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.order_messages
    ADD CONSTRAINT order_messages_order_id_fkey FOREIGN KEY (order_id) REFERENCES public.orders(id) ON DELETE CASCADE;


--
-- TOC entry 4995 (class 2606 OID 18837)
-- Name: order_messages order_messages_to_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.order_messages
    ADD CONSTRAINT order_messages_to_user_id_fkey FOREIGN KEY (to_user_id) REFERENCES public.users(id);


--
-- TOC entry 4983 (class 2606 OID 18689)
-- Name: orders orders_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.orders
    ADD CONSTRAINT orders_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id);


--
-- TOC entry 4989 (class 2606 OID 18764)
-- Name: payment_intents payment_intents_order_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.payment_intents
    ADD CONSTRAINT payment_intents_order_id_fkey FOREIGN KEY (order_id) REFERENCES public.orders(id);


--
-- TOC entry 4990 (class 2606 OID 18785)
-- Name: payouts payouts_sub_order_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.payouts
    ADD CONSTRAINT payouts_sub_order_id_fkey FOREIGN KEY (sub_order_id) REFERENCES public.sub_orders(id);


--
-- TOC entry 4979 (class 2606 OID 18642)
-- Name: product_variants product_variants_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.product_variants
    ADD CONSTRAINT product_variants_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id) ON DELETE CASCADE;


--
-- TOC entry 4996 (class 2606 OID 18870)
-- Name: product_versions product_versions_changed_by_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.product_versions
    ADD CONSTRAINT product_versions_changed_by_user_id_fkey FOREIGN KEY (changed_by_user_id) REFERENCES public.users(id);


--
-- TOC entry 4997 (class 2606 OID 18865)
-- Name: product_versions product_versions_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.product_versions
    ADD CONSTRAINT product_versions_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id) ON DELETE CASCADE;


--
-- TOC entry 4978 (class 2606 OID 18621)
-- Name: products products_store_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.products
    ADD CONSTRAINT products_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id) ON DELETE CASCADE;


--
-- TOC entry 4991 (class 2606 OID 18810)
-- Name: refunds refunds_order_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.refunds
    ADD CONSTRAINT refunds_order_id_fkey FOREIGN KEY (order_id) REFERENCES public.orders(id);


--
-- TOC entry 4992 (class 2606 OID 18805)
-- Name: refunds refunds_payment_intent_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.refunds
    ADD CONSTRAINT refunds_payment_intent_id_fkey FOREIGN KEY (payment_intent_id) REFERENCES public.payment_intents(id);


--
-- TOC entry 4980 (class 2606 OID 18662)
-- Name: reservations reservations_product_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.reservations
    ADD CONSTRAINT reservations_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.products(id) ON DELETE SET NULL;


--
-- TOC entry 4981 (class 2606 OID 18657)
-- Name: reservations reservations_product_variant_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.reservations
    ADD CONSTRAINT reservations_product_variant_id_fkey FOREIGN KEY (product_variant_id) REFERENCES public.product_variants(id) ON DELETE SET NULL;


--
-- TOC entry 4982 (class 2606 OID 18667)
-- Name: reservations reservations_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.reservations
    ADD CONSTRAINT reservations_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id);


--
-- TOC entry 4974 (class 2606 OID 18557)
-- Name: store_users store_users_store_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.store_users
    ADD CONSTRAINT store_users_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id) ON DELETE CASCADE;


--
-- TOC entry 4975 (class 2606 OID 18562)
-- Name: store_users store_users_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.store_users
    ADD CONSTRAINT store_users_user_id_fkey FOREIGN KEY (user_id) REFERENCES public.users(id) ON DELETE CASCADE;


--
-- TOC entry 4973 (class 2606 OID 18535)
-- Name: stores stores_owner_user_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.stores
    ADD CONSTRAINT stores_owner_user_id_fkey FOREIGN KEY (owner_user_id) REFERENCES public.users(id);


--
-- TOC entry 4984 (class 2606 OID 18711)
-- Name: sub_orders sub_orders_order_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.sub_orders
    ADD CONSTRAINT sub_orders_order_id_fkey FOREIGN KEY (order_id) REFERENCES public.orders(id) ON DELETE CASCADE;


--
-- TOC entry 4985 (class 2606 OID 18716)
-- Name: sub_orders sub_orders_store_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.sub_orders
    ADD CONSTRAINT sub_orders_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id);


--
-- TOC entry 4976 (class 2606 OID 18598)
-- Name: subscriptions subscriptions_plan_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.subscriptions
    ADD CONSTRAINT subscriptions_plan_id_fkey FOREIGN KEY (plan_id) REFERENCES public.plans(id);


--
-- TOC entry 4977 (class 2606 OID 18593)
-- Name: subscriptions subscriptions_store_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public.subscriptions
    ADD CONSTRAINT subscriptions_store_id_fkey FOREIGN KEY (store_id) REFERENCES public.stores(id) ON DELETE CASCADE;


-- Completed on 2025-09-08 12:53:33

--
-- PostgreSQL database dump complete
--

